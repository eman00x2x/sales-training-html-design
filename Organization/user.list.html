<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Second Page</title>

  <!-- <link rel="stylesheet" href="/Cdn/vendor/bootstrap-5.3.3/css/bootstrap.min.css"> -->
  <script src="/Cdn/vendor/popper-2.11.8/popper.min.js"></script>
  <script src="/Cdn/vendor/jquery-3.7.1/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">   
  <link rel="stylesheet" href="/Cdn/css/organization.user.list.css">

  <script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/js/tabler.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/css/tabler.min.css">


  
  <script type="text/javascript">

     $(document).ready(function () {

      $(".header").load("../Admin/header.html");
      $(".sidebar").load("navbar.html");
      $(".footer").load("../Admin/footer.html");

      const profileJson = "../Cdn/js/data/profiles.json";
      const accountJson = "../Cdn/js/data/accounts.json";
      fetch(profileJson)
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json();
        })
        .then(OrganizationUserData => {


          fetch(accountJson)
            .then((response) => response.json())
            .then((accountData) => {
                processData(OrganizationUserData,accountData)
            })
            .catch((error) =>
              console.error("Error fetching account data:", error)
            );

            
        })
        .catch((error) => {
          console.error(
            "There was a problem with the fetch operation:",
            error
          );
        });

        function processData(OrganizationUserData, accountData) {

    

     function createRow(org, accountData) {
    const { profile_id, profile_image, name, address } = org;

        const tableBody = $(".userTable tbody");
        let fullName = `${name.prefix} ${name.firstname} ${name.lastname} ${name.suffix}`;
        let permanentAddress = address[0].permanent;
        let fullAddress = `${permanentAddress.region}, ${permanentAddress.province}, ${permanentAddress.municipality}, ${permanentAddress.barangay}`;
        let accType = "";
        accountData.data.forEach(account => {
            if (org.account_id === account.account_id) {
                accType = account.account_type;
            }
        });
        let newRow = `
        <tr>
            <td>${profile_id}</td>
            <td><img src="${profile_image}" alt="Profile Image" class="profileImg"></td>
            <td>${fullName}</td>
            <td>${fullAddress}</td>
            <td>${accType}</td>
            <td>
                            <div class="d-flex flex-nowrap gap-1">
                              <a class="btn border-primary bg-body" href="user.view.html?id=${profile_id}" > <i class="bi bi-eye"></i> View</a>

                                <a class="btn border-primary bg-body"" href="user.view.update.html?id=${profile_id}"> <i class="bi bi-pencil-square"></i> Edit</a> 
                             <a class="btn border-danger bg-body" href="user.delete.html?id=${profile_id}" > <i class="bi bi-trash"></i> Delete</a>

                            </div>
                          </td>
        </tr>
    `;
        tableBody.append(newRow);
    

    // const editBtn = $('.editBtn')

    
    // $('.editBtn').click(function() {
    //     const rowIndex = $(this).closest('tr').index(); // Get the index of the row containing the clicked edit button
    //     const clickedOrg = OrganizationUserData.data[rowIndex]; // Retrieve the organization data corresponding to the clicked row
    //     const clickedCardData = {
    //         profile_id: clickedOrg.profile_id,
    //         profile_image: clickedOrg.profile_image, 
    //         name: clickedOrg.name,
    //         address: clickedOrg.address
    //     };
    //     sessionStorage.setItem('clickedCardData', JSON.stringify(clickedCardData));
    //     console.log("Clicked Card Data Stored:", clickedCardData);
    // }); 
    


   
}



OrganizationUserData.data.forEach(org => {
    createRow(org, accountData);
});
        const totalPages = Math.ceil(OrganizationUserData.data.length / 10);
        console.log(totalPages);
        displayPagination(totalPages);

    

        function displayPagination(totalPages) {
        const pagination = $('#pagination');
        const page = $('<ul>').addClass('pagination').addClass('pagination-sm').css('color','black');
        
        for (let i = 1; i <= totalPages; i++) {
            const pageLink = $('<a>').addClass('page-link').text(i);
            const pageItem = $('<li>').addClass('page-item').append(pageLink);
        
            pageLink.on('click', function () {
                displayPage(i);
                updatePaginationUI(i);  
            });
            page.append(pageItem);
        }
        
        pagination.append(page);
    }

    function displayPage(pageNumber) {

    const tableBody = $(".userTable tbody");
    tableBody.empty(); // Clear the table body before displaying new data
    const startIndex = (pageNumber - 1) * 10; // Adjusted startIndex for pagination limit of 10
    const endIndex = Math.min(startIndex + 10, OrganizationUserData.data.length); // Adjusted endIndex
    for (let i = startIndex; i < endIndex; i++) {
        const org = OrganizationUserData.data[i]; // Retrieve organization data for the current index
        const { profile_id, profile_image, name, address } = org;
        let fullName = `${name.prefix} ${name.firstname} ${name.lastname} ${name.suffix}`;
        let permanentAddress = address[0].permanent;
        let fullAddress = `${permanentAddress.region}, ${permanentAddress.province}, ${permanentAddress.municipality}, ${permanentAddress.barangay}`;
        let accType = "";
        accountData.data.forEach(account => {
            if (org.account_id === account.account_id) {
                accType = account.account_type;
            }
        });
        let newRow = `
        <tr>
            <td>${profile_id}</td>
            <td><img src="${profile_image}" alt="Profile Image" class="profileImg"></td>
            <td>${fullName}</td>
            <td>${fullAddress}</td>
            <td>${accType}</td>
            <td>
                            <div class="d-grid gap-1">
                              <a class="btn border-primary bg-body" href="user.view.html?id=${profile_id}" > <i class="bi bi-eye"></i> View</a>

<a class="btn border-primary bg-body"" href="user.view.update.html?id=${profile_id}"> <i class="bi bi-pencil-square"></i> Edit</a> 
<a class="btn border-danger bg-body" href="user.delete.html?id=${profile_id}" > <i class="bi bi-trash"></i> Delete</a>
                            </div>
                          </td>
        </tr>
    `;
        tableBody.append(newRow);
    }
}


    function updatePaginationUI(currentPage) {
        $('.page-item').removeClass('active');
        $(`.page-item:eq(${currentPage - 1})`).addClass('active');
    }



}


        
     
    });
  </script>


</head>

<body id="body-pd"> 
  <div id="navbar-container"></div>


    <div class="container-fluid pt-3">
        <div class="content pt-1">
          <div class="title">
            <h1 class="fw-bold text-primary">
              <i class="bi bi-people-fill"></i> REGISTERED USERS LIST
            </h1>
          </div>

          <div class="filter">
            <div class="row">
              <div class="col-lg-2 col-sm-12">
                <select class="form-select" name="sortby" id="sortby">
                  <option value="" disabled selected>Sort By</option>
                  <option value="">Account ID</option>
                  <option value="">Surname</option>
                  <option value="">Account Type</option>
                </select>
              </div>
    
              <div class="col-lg-4 col-sm-12">
                <div class="input-group">
                  <span class="input-group-text" id="basic-addon1"><i class="bi bi-search"></i ></span>
                  <input  type="search" class="form-control" placeholder="Search User" name="search" id="search"/>
                </div>
              </div>
    
              <div class="col-lg-6 col-sm-12 d-flex justify-content-end">
                <div class="">
                  <a href="user.create.html" class="btn btn-success " >
                    <i class="bi bi-plus-lg"></i> Add User 
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div class="userTable mt-2">
            <div class="table-responsive">
              <table class="table table-striped text-center">
                <thead >
                  <tr  id="tableHead" class="">
                    <th>#</th>
                    <th>User Profile Image</th>
                    <th >Full Name</th>
                    <th >Address</th>
                    <th >Account Type</th>
                    <th >Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>
    <div class="d-flex justify-content-between">
      <div>
       <p>Page 1 of 3 </p>
      </div>
      <nav id="pagination" class="pt-3 text-primary">


      </nav>
  
    </div>
          

        </div>
    </div>


    <div class="">
    
   </div>
  <!-- Pagination -->


<!-- <script src="fetchNav.js"></script> -->

  <script>

    
  function toggleMenu() {
      const menu = document.getElementById("nav-bar");
      const toggleButton = document.getElementById("header-toggle");
      const bodypd = document.getElementById("body-pd");
      const headerpd = document.getElementById("header");

      if (menu && toggleButton && bodypd && headerpd) {
        menu.classList.toggle('show');
        toggleButton.classList.toggle('bi-x');
        bodypd.classList.toggle('body-pd');
       headerpd.classList.toggle('body-pd');
      }
    }

    fetch("navbar.html")
      .then(response => response.text())
      .then(htmlContent => {
        document.getElementById("navbar-container").innerHTML = htmlContent;
        document.getElementById("header-toggle").addEventListener('click', toggleMenu);
      })
      .catch(error => console.error(error));
  </script>


</body>
</html>
