<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Organization User Create</title>

    <link
      href="../Cdn/vendor/bootstrap-5.3.3/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../Cdn/css/organization.list.css" />
    <script src="../Cdn/vendor/jquery-3.7.1/jquery-3.7.1.min.js"></script>
    <script src="../Cdn/vendor/popper-2.11.8/popper.min.js"></script>
    <script src="../Cdn/vendor/bootstrap-5.3.3/js/bootstrap.min.js"></script>
    <script src="../Cdn/js/script.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <link rel="stylesheet" href="/Cdn/css/organization.user.list.css">

    <script type="text/javascript">
      $(document).ready(function () {
        $(".header").load("../Admin/header.html");
        $(".sidebar").load("../Admin/sidebar.html");
        $(".footer").load("../Admin/footer.html");

        const profileJson = "../Cdn/js/data/profiles.json";
        const accountJson = "../Cdn/js/data/accounts.json";
        fetch(profileJson)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Network response was not ok");
            }
            return response.json();
          })
          .then((OrganizationUserData) => {
            fetch(accountJson)
              .then((response) => response.json())
              .then((accountData) => {
                printAccountInfo(OrganizationUserData, accountData);
              })
              .catch((error) =>
                console.error("Error fetching account data:", error)
              );
          })
          .catch((error) => {
            console.error(
              "There was a problem with the fetch operation:",
              error
            );
          });

        function printAccountInfo(OrganizationUserData, accountData) {
          let tableBody = $(".userTable tbody");
          tableBody.empty();
          OrganizationUserData.data.forEach((profileData, index) => {
            let fullName = `${profileData.name.prefix} ${profileData.name.firstname} ${profileData.name.lastname} ${profileData.name.suffix}`;
            let permanentAddress = profileData.address[0].permanent;
            let fullAddress = `${permanentAddress.region}, ${permanentAddress.province}, ${permanentAddress.municipality}, ${permanentAddress.barangay}`;
            let row = `<tr>
                        <td>${index + 1}</td>
                        <td><img src="${profileData.profile_image}" alt="Profile Image" id="profileImg"/></td>
                        <td>${fullName}</td>
                        <td>${fullAddress}</td>
                        <td class="accType"></td>
                        <td><button class="btn btn-sm btn-primary">Edit</button></td>
                    </tr>`;
            tableBody.append(row);

            let accTypeCell = tableBody.find(".accType").eq(index);
            accountData.data.forEach((account, index) => {
              if (profileData.account_id === account.account_id) {
                accTypeCell.text(account.account_type);
              }
            });
          });
        }
      });
    </script>
  </head>
  <body>
    <div class="container-fluid">
      <div class="row">
        <div
          class="sidebar col-md-3 col-lg-2 px-sm-2 px-0 bg-light"
        
        ></div>

        <main class="col-md-9 col-lg-10 py-2">
          <div class="header"></div>
          <div class="container">
            <div class="title">
              <h3 class="fw-bold">
                <i class="bi bi-people-fill"></i> REGISTERED USERS LIST
              </h3>
            </div>

            <div class="filter">
              <div class="row d-flex">
                <div class="col-lg-2">
                  <select class="form-select" name="sortby" id="sortby">
                    <option value="" disabled selected>Sort By</option>
                  </select>
                </div>

                <div class="col-lg-4">
                  <div class="input-group">
                    <span class="input-group-text" id="basic-addon1"><i class="bi bi-search"></i ></span>
                    <input  type="search" class="form-control" placeholder="Search User" name="search" id="search"/>
                  </div>
                </div>

                <div class="col-6">
                  <div class="d-flex justify-content-end">
                    <button class="btn w-25" style="background-color: #131c39; color: white">
                      <i class="bi bi-plus-lg"></i>
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <div class="userTable mt-2">
              <div class="table-responsive">
                <table class="table table-striped text-center">
                  <thead >
                    <tr  id="tableHead" class="">
                      <th >#</th>
                      <th>User Profile Image</th>
                      <th >Full Name</th>
                      <th >Address</th>
                      <th >Account Type</th>
                      <th >Actions</th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
            </div>
          </div>
        </main>
      </div>
    </div>
  </body>

 
</html>
