<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Second Page</title>

  <link rel="stylesheet" href="/Cdn/vendor/bootstrap-5.3.3/css/bootstrap.min.css">
  <script src="/Cdn/vendor/popper-2.11.8/popper.min.js"></script>
  <script src="/Cdn/vendor/jquery-3.7.1/jquery-3.7.1.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">   
  <link rel="stylesheet" href="/Cdn/css/organization.user.list.css">

  <script type="text/javascript">
    $(document).ready(function () {
      $(".header").load("../Admin/header.html");
      $(".sidebar").load("navbar.html");
      $(".footer").load("../Admin/footer.html");

      const profileJson = "../Cdn/js/data/profiles.json";
      const accountJson = "../Cdn/js/data/accounts.json";
      fetch(profileJson)
        .then((response) => {
          if (!response.ok) {
            throw new Error("Network response was not ok");
          }
          return response.json();
        })
        .then((OrganizationUserData) => {
          fetch(accountJson)
            .then((response) => response.json())
            .then((accountData) => {
              printAccountInfo(OrganizationUserData, accountData);
            })
            .catch((error) =>
              console.error("Error fetching account data:", error)
            );
        })
        .catch((error) => {
          console.error(
            "There was a problem with the fetch operation:",
            error
          );
        });

      function printAccountInfo(OrganizationUserData, accountData) {

        // OrganizationUserData.data.sort((a, b) => {
        //     return a.name.suffix.localeCompare(b.name.suffix);
        // });

        let tableBody = $(".userTable tbody");
        tableBody.empty();
        OrganizationUserData.data.forEach((profileData, index) => {
          let fullName = `${profileData.name.prefix} ${profileData.name.firstname} ${profileData.name.lastname} ${profileData.name.suffix}`;
          let permanentAddress = profileData.address[0].permanent;
          let fullAddress = `${permanentAddress.region}, ${permanentAddress.province}, ${permanentAddress.municipality}, ${permanentAddress.barangay}`;
          let row = `<tr>
                      <td>${index + 1}</td>
                      <td><img src="${profileData.profile_image}" alt="Profile Image" id="profileImg"/></td>
                      <td>${fullName}</td>
                      <td>${fullAddress}</td>
                      <td class="accType"></td>
                      <td>
                        <div class="d-grid gap-1">
  <button class="btn btn-primary">
    Edit
  </button>
  <button class="btn btn-danger">
    Delete
  </button>
</div>
                        </td>
                  </tr>`;
          tableBody.append(row);

          let accTypeCell = tableBody.find(".accType").eq(index);
          accountData.data.forEach((account, index) => {
            if (profileData.account_id === account.account_id) {
              accTypeCell.text(account.account_type);
            }
          });
       
       console.log(profileData.name.suffix)
       
      // let sortByName = profileData.name.suffix.sort()

       
        });
      

      
      
      }
    

    
    
    
    
    
    });
  </script>


</head>





<body id="body-pd"> 
  <div id="navbar-container"></div>


    <div class="container-fluid pt-3">
        <div class="content pt-1">
          <div class="title">
            <h3 class="fw-bold">
              <i class="bi bi-people-fill"></i> REGISTERED USERS LIST
            </h3>
          </div>

          <div class="filter">
            <div class="row">
              <div class="col-lg-2 col-sm-12">
                <select class="form-select" name="sortby" id="sortby">
                  <option value="" disabled selected>Sort By</option>
                  <option value="">Account ID</option>
                  <option value="">Surname</option>
                  <option value="">Account Type</option>
                </select>
              </div>
    
              <div class="col-lg-4 col-sm-12">
                <div class="input-group">
                  <span class="input-group-text" id="basic-addon1"><i class="bi bi-search"></i ></span>
                  <input  type="search" class="form-control" placeholder="Search User" name="search" id="search"/>
                </div>
              </div>
    
              <div class="col-lg-6 col-sm-12 d-flex justify-content-end">
                <div class="">
                  <button class="btn btn-success " >
                    <i class="bi bi-plus-lg"></i> Add User 
                  </button>
                </div>
              </div>
            </div>
          </div>

          <div class="userTable mt-2">
            <div class="table-responsive">
              <table class="table table-striped text-center">
                <thead >
                  <tr  id="tableHead" class="">
                    <th >#</th>
                    <th>User Profile Image</th>
                    <th >Full Name</th>
                    <th >Address</th>
                    <th >Account Type</th>
                    <th >Actions</th>
                  </tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </div>

        </div>
    </div>




<!-- <script src="fetchNav.js"></script> -->

  <script>

    
  function toggleMenu() {
      const menu = document.getElementById("nav-bar");
      const toggleButton = document.getElementById("header-toggle");
      const bodypd = document.getElementById("body-pd");
      const headerpd = document.getElementById("header");

      if (menu && toggleButton && bodypd && headerpd) {
        menu.classList.toggle('show');
        toggleButton.classList.toggle('bi-x');
        bodypd.classList.toggle('body-pd');
       headerpd.classList.toggle('body-pd');
      }
    }

    fetch("navbar.html")
      .then(response => response.text())
      .then(htmlContent => {
        document.getElementById("navbar-container").innerHTML = htmlContent;
        document.getElementById("header-toggle").addEventListener('click', toggleMenu);
      })
      .catch(error => console.error(error));
  </script>


</body>
</html>
