<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Update User Information</title>

    <link
      rel="stylesheet"
      href="/Cdn/vendor/bootstrap-5.3.3/css/bootstrap.min.css"
    />
    <script src="/Cdn/vendor/popper-2.11.8/popper.min.js"></script>
    <script src="/Cdn/vendor/jquery-3.7.1/jquery-3.7.1.min.js"></script>
    <!-- <script src="/Cdn/vendor/bootstrap-5.3.3/js/bootstrap.bundle.js"></script> -->
    <link rel="stylesheet"href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css"/>
    <link rel="stylesheet" href="/Cdn/css/organization.user.list.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/css/tabler.min.css">
    <script src="../Cdn/vendor/validatejs-0.13.1/validate.min.js"></script>
    <script src="../Cdn/js/script.js"></script>
  
    <script>
      $(document).ready(function () {
        let params = new URL(document.location.toString()).searchParams;
        let id = params.get("id");

        $.getJSON("../Cdn/js/data/profiles.json", function (data) {


          $.getJSON("../Cdn/js/data/accounts.json", function (account) { 

          let response = data.data;
          let accountResponse = account.data;
          let userData = response.find((item) => item.profile_id == id);
          let accountData =  accountResponse.find((item) => item.account_id == id);


          console.log(accountData.account_type)

          let fullName = `${userData.name.prefix} ${userData.name.firstname} ${userData.name.lastname} ${userData.name.suffix}`;
          let permanentAddress = userData.address[0].permanent;
          let fullAddress = `${permanentAddress.region}, ${permanentAddress.province}, ${permanentAddress.municipality}, ${permanentAddress.barangay}`;
          let accType = "";

          $(".user-img").attr("src", userData.profile_image);
          $("#lastname").val(userData.name.suffix);
          $("#name").val(userData.name.firstname);
          $("#address").val(fullAddress);
          $("#contact").val(userData.contact_number);
          $("#type").val(accountData.account_type)
          $(".bread-title").text(fullName)

          });



       
        });
      });

      $(document).on("click", "#back", function (e) {
      window.location.href = "user.list.html"
    });

    $(document).on("change", "#logo", function (e) {
      var URL = window.URL || window.webkitURL;
      var file = e.target.files[0];

      if (file) {
        $(".user-img").attr("src", URL.createObjectURL(file));
      }
    });

      function validateInput(input) {
        let message = [];

        const data = input.reduce(function (obj, item) {
          obj[item.name] = item.value;
          return obj;
        }, {});

        const validator = validate(
          {
            logo: data.logo,
            lastname: data.lastname,
            firstname: data.fname,
            mname: data.mname,
          },
          {
            logo: {
              type: "image/png,image/jpeg",
            },
            lastname: {
              type: "string",
              length: { minimum: 4 },
            },

            firstname: {
              type: "string",
              length: { minimum: 4 },
            },

            lastname: {
              type: "string",
              length: { minimum: 4 },
            },
          }
        );

        if (validator !== undefined) {
          for (key in validator) {
            message.push(validator[key]);
          }
          return message.join(", ");
        }

        return false;
      }
    </script>
  </head>
  <body id="body-pd">
    <div id="navbar-container"></div>




    <div class="container content pt-3">

      <nav class=""
      style="--bs-breadcrumb-divider: url(&#34;data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='8'%3E%3Cpath d='M2.5 0L1 1.5 3.5 4 1 6.5 2.5 8l4-4-4-4z' fill='%236c757d'/%3E%3C/svg%3E&#34;);"
      aria-label="breadcrumb">
      <ol class="breadcrumb">

        <div class="breadcrumb-item">
          <li class=""><a class="text-decoration-none text-secondary" href="user.list.html">All Listing / Edit User Profile</a></li>
        </div>
        
        <div class="breadcrumb-item flex-grow-1 ">
          <li class="breadcrumb-item active w-100 bread-title" id="bread-title" aria-current="page"></li>
        </div>
      </ol>
    </nav>

      <div class="card px-3 py-2">
        <div class="card-header bg-white">
          <h1 class="text-primary"><i class="bi bi-person-circle"></i> Update User Information</h1>
      

        </div>
       

        <div class="card-body">
          <div class="response "></div>
       <form id="form" action="" method="post">
         
              <div class="">
               

                  <div class="row">

                      <div class="col-lg-4 col-sm-12">
                        <img src="" class="user-img" alt="" />

                      </div>


                      <div class="col-lg-8 col-sm-12">
                        <div class="row flex-row flex-wrap ">
                       
                          <div class="col-lg-4 col-sm-12 pt-2">
                            <label for="surname"> Surname:</label>
                            <input type="text" name="lastname" id="lastname" value="" class="form-control" autocomplete="off" />
                          </div>
                          <div class="col-lg-4 col-sm-12 pt-2">
                            <label for="surname"> First Name</label>
                            <input type="text" name="name" id="name" value="" class="form-control" autocomplete="off" />
                          </div> 
        
                          <div class="col-lg-4 col-sm-12 pt-2">
                            <label for="surname"> Middle Name</label>
                            <input type="text" name="mname" id="mname" value="" class="form-control" autocomplete="off" />
                          </div>
                          <div class="col-lg-8 col-sm-12 pt-2">
                            <label for="contact"> Address</label>
                            <input type="text" name="address" id="address" autocomplete="off" class="form-control" />
                          </div> 
                          <div class="col-lg-4 col-sm-12 pt-2">
                            <label for="contact"> Contact No</label>
                            <input type="text" name="contact" id="contact" autocomplete="off" class="form-control" />
                          </div> 
                          <div class="col-lg-8 col-sm-12 pt-2">
                            <label>Edit Profile Image</label>
                            <input type="file" class="form-control" id="logo"/>
                            
                          </div>
                          <div class="col-lg-4 col-sm-12 pt-2">
                            <label for="type"> Account Type</label>
                            <input name="type" id="type"  class="form-control" autocomplete="off">
                          </div>
                       
        
                          
                        
                       </div>
                      </div>

                  </div>

                 


           
                <!--  -->
              </div>

      

            <div class="d-flex justify-content-end pt-3 gap-1">
              <button id="back" type="button" class="btn border border-secondary" data-bs-dismiss="modal">
                Back
              </button>              <button type="button" class="btn btn-save btn-success">
                Update
              </button>
            </div>
          </form> 
        

         
        
        
        </div>
      </div>
    </div>

    <script>
      function toggleMenu() {
        const menu = document.getElementById("nav-bar");
        const toggleButton = document.getElementById("header-toggle");
        const bodypd = document.getElementById("body-pd");
        const headerpd = document.getElementById("header");

        if (menu && toggleButton && bodypd && headerpd) {
          menu.classList.toggle("show");
          toggleButton.classList.toggle("bi-x");
          bodypd.classList.toggle("body-pd");
          headerpd.classList.toggle("body-pd");
        }
      }

      fetch("navbar.html")
        .then((response) => response.text())
        .then((htmlContent) => {
          document.getElementById("navbar-container").innerHTML = htmlContent;
          document
            .getElementById("header-toggle")
            .addEventListener("click", toggleMenu);
        })
        .catch((error) => console.error(error));
    </script>

<script src="https://cdn.jsdelivr.net/npm/@tabler/core@1.0.0-beta17/dist/js/tabler.min.js"></script>

  </body>
</html>
