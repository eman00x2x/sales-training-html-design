<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Organizations</title>
  <link href="../Cdn/vendor/bootstrap-5.3.3/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../Cdn/css/admin.global.css" />
  <script src="../Cdn/vendor/jquery-3.7.1/jquery-3.7.1.min.js"></script>
  <script src="../Cdn/vendor/popper-2.11.8/popper.min.js"></script>
  <script src="../Cdn/vendor/bootstrap-5.3.3/js/bootstrap.min.js"></script>
  <script src="../Cdn/js/script.js"></script>

  <script type="text/javascript">
    $(document).ready(function () {
      $(".header").load("header.html");
      $(".sidebar").load("sidebar.html");
      $(".footer").load("footer.html");
      getOrganizationsData();
    });

    $(document).on('click', '.btn-add', function (e) {
      window.location.href = "organization.create.html";
    });

    $(document).on('click', '.btn-edit', function (e) {
      id = $(this).data('id');
      $.getJSON('../Cdn/js/data/organization.json', function (data) {
        let response = data.data;
        f = response.keys(response).find(key => response[key].organization_id === id);

        window.location.href = "organization.update.html?id=" + id;

        // $('#dynamicModal .response-data-container').html(JSON.stringify(response[f]));
      });
    });

    $(document).on('click', '.btn-delete', function (e) {
      id = $(this).data('id');
      $.getJSON('../Cdn/js/data/organization.json', function (data) {
        let response = data.data;
        f = response.keys(response).find(key => response[key].organization_id === id);

        window.location.href = "organization.delete.html?id=" + id;
      });
    });

    // $(document).on('keyup', '.search', function (e) {
    //   const value = e.target.value.trim();

    //   $.getJSON('../Cdn/js/data/organization.json', function (data) {
    //     let response = data.data;
    //     f = Array.from(response.keys(response).filter(key => response[key].name.toLowerCase().includes(value.toLowerCase())))

    //     dataTable(f, response)
    //   });
    // });

    function displayActionButtons(id) {
      return `<td class='align-middle'>
          <span class='btn btn-sm btn-view border border-primary btn-view text-primary' data-title="View Organization">
            <svg xmlns='http://www.w3.org/2000/svg' width='2em' height='2em' viewBox='0 0 32 32'> 
              <circle cx='16' cy='16' r='4' fill='currentColor'/>
              <path fill='currentColor' d='M30.94 15.66A16.69 16.69 0 0 0 16 5A16.69 16.69 0 0 0 1.06 15.66a1 1 0 0 0 0 .68A16.69 16.69 0 0 0 16 27a16.69 16.69 0 0 0 14.94-10.66a1 1 0 0 0 0-.68M16 22.5a6.5 6.5 0 1 1 6.5-6.5a6.51 6.51 0 0 1-6.5 6.5'/>
            </svg>
          </span>
          <span data-id='${id}' class='btn btn-sm btn-edit' style="border: 1; border-color: #C68914; color: #c68914" data-title="Update Organization Details">
            <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em" viewBox="0 0 24 24">
              <path fill="currentColor" d="m7 17.013l4.413-.015l9.632-9.54c.378-.378.586-.88.586-1.414s-.208-1.036-.586-1.414l-1.586-1.586c-.756-.756-2.075-.752-2.825-.003L7 12.583zM18.045 4.458l1.589 1.583l-1.597 1.582l-1.586-1.585zM9 13.417l6.03-5.973l1.586 1.586l-6.029 5.971L9 15.006z"/>
              <path fill="currentColor" d="M5 21h14c1.103 0 2-.897 2-2v-8.668l-2 2V19H8.158c-.026 0-.053.01-.079.01c-.033 0-.066-.009-.1-.01H5V5h6.847l2-2H5c-1.103 0-2 .897-2 2v14c0 1.103.897 2 2 2"/>
            </svg>
          </span>
          <span data-id='${id}' class='btn btn-sm text-danger border border-danger btn-delete ' data-title="Delete Organization">
            <svg xmlns="http://www.w3.org/2000/svg" width="2em" height="2em"" viewBox="0 0 24 24">
              <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="m18 9l-.84 8.398c-.127 1.273-.19 1.909-.48 2.39a2.5 2.5 0 0 1-1.075.973C15.098 21 14.46 21 13.18 21h-2.36c-1.279 0-1.918 0-2.425-.24a2.5 2.5 0 0 1-1.076-.973c-.288-.48-.352-1.116-.48-2.389L6 9m7.5 6.5v-5m-3 5v-5m-6-4h4.615m0 0l.386-2.672c.112-.486.516-.828.98-.828h3.038c.464 0 .867.342.98.828l.386 2.672m-5.77 0h5.77m0 0H19.5"/>
            </svg>
          </span>
        </td>`;
    }

    // function dataTable(f, response) {
    //   let html = "";

    //   for (let item in f) {
    //     let data = response[item];

    //     html += "<tr>";
    //     html +=
    //       "<td class='align-middle text-center'>" +
    //       data.organization_id +
    //       "</td>";
    //     html +=
    //       "<td class='align-middle text-center' style='max-width: 50px'><img src='" +
    //       data.logo +
    //       "' style='width:10em;' /></td>";
    //     html += "<td class='align-middle'>" + data.name + "</td>";
    //     html +=
    //       "<td class='align-middle text-truncate' style='max-width: 150px'>" +
    //       data.description +
    //       "</td>";
    //     html +=
    //       "<td class='align-middle'>" +
    //       convertDate(data.created_at) +
    //       "</td>";
    //     html += displayActionButtons(data.organization_id);
    //     html += "</tr>";
    //   }

    //   $(".organizations .data-container").html(html);
    // }

    function getOrganizationsData() {
      let html = "";

      $.getJSON("../Cdn/js/data/organization.json", function (response) {
        const org = response.data;

        for (let i = 0; i < org.length; i++) {
          let data = org[i];

          html += "<tr>";
          html +=
            "<td class='align-middle text-center'>" +
            data.organization_id +
            "</td>";
          html +=
            "<td class='align-middle text-center' style='max-width: 50px'><img src='" +
            data.logo +
            "' style='width:10em;' /></td>";
          html += "<td class='align-middle'>" + data.name + "</td>";
          html +=
            "<td class='align-middle text-truncate' style='max-width: 150px'>" +
            data.description +
            "</td>";
          html +=
            "<td class='align-middle'>" +
            convertDate(data.created_at) +
            "</td>";
          html += displayActionButtons(data.organization_id);
          html += "</tr>";
        }
        $(".organizations .data-container").html(html);
      });
    }
  </script>
</head>

<body>
  <!-- DYNAMIC MODAL -->
  <div class="modal fade" id="dynamicModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered" id="form-content">
      <div class="modal-content">
        <div class="response-data-container"></div>
      </div>
    </div>
  </div>

  <div class="container-fluid">
    <div class="row flex-nowrap" style="height: 100vh">
      <!-- SIDEBAR -->
      <div class="sidebar col-md-3 col-lg-2 px-sm-2 px-0 bg-light"></div>
      <main class="col py-3">
        <!-- HEADER -->
        <div class="header"></div>

        <!-- CONTENT -->
        <div class="content">
          <div>

            <!-- TITLE -->
            <div class="d-flex flex-row align-items-center justify-content-start mt-2">
              <svg xmlns="http://www.w3.org/2000/svg" width="2.5em" height="2.5em" viewBox="0 0 32 32">
                <path fill="currentColor"
                  d="M11 7a5 5 0 1 1 5.999 4.9V15h5.268A2.733 2.733 0 0 1 25 17.732V20.1a5.002 5.002 0 0 1-1 9.9a5 5 0 0 1-1-9.9v-2.368a.733.733 0 0 0-.733-.733H9.733a.733.733 0 0 0-.733.733V20.1A5.002 5.002 0 0 1 8 30a5 5 0 0 1-1-9.9v-2.368a2.733 2.733 0 0 1 2.733-2.733H15v-3.1A5 5 0 0 1 11 7" />
              </svg>
              <span class="fw-bold fs-2 ms-2">ORGANIZATION</span>
            </div>

            <!-- SORT, FILTER AND SEARCH -->
            <div class="d-flex justify-content-between align-items-center mb-3 mt-2">
              <div class="d-flex justify-content-start align-items-center w-50">
                <div class="btn-group border border-secondary-subtle">
                  <button type="button" class="btn btn-light dropdown-toggle fw-semibold text-lg-start"
                    data-bs-toggle="dropdown" aria-expanded="false">
                    SORT BY
                  </button>
                  <ul class="dropdown-menu">
                    <li>
                      <a class="dropdown-item" href="#">Organization Name</a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#">Created Date</a>
                    </li>
                  </ul>
                </div>
                <input type="text" class="search ms-1 form-control" id="search"
                  placeholder="Search by Organization Name" name="search" value="" />
              </div>
              <button type="button" class="btn text-white px-5 btn-add" data-title="Add Organization"
                style="background-color: #131c39 !important">
                <i class="bi bi-plus-circle fs-5"></i>
              </button>
            </div>
          </div>

          <!-- TABLE LIST -->
          <div class="list">
            <div class="table-responsive">
              <table class="table table-bordered table-striped organizations">
                <thead>
                  <tr>
                    <th class="align-middle text-center fw-semibold text-white" style="background-color: #1c1c39">
                      #
                    </th>
                    <th class="align-middle text-center fw-semibold text-white" style="background-color: #1c1c39">
                      Organization Logo
                    </th>
                    <th class="align-middle fw-semibold text-white" style="background-color: #1c1c39">
                      Organization Name
                    </th>
                    <th class="align-middle fw-semibold text-white" style="background-color: #1c1c39">
                      Organization Description
                    </th>
                    <th class="align-middle fw-semibold text-white" style="background-color: #1c1c39">
                      Created Date
                    </th>
                    <th class="align-middle fw-semibold text-white" style="background-color: #1c1c39">
                      Actions
                    </th>
                  </tr>
                </thead>
                <tbody class="data-container"></tbody>
              </table>
            </div>
          </div>

          <!-- TABLE FOOTER -->
          <div style="display: flex; align-items: center">
            <p style="margin-right: auto">Showing 1 out of 10 pages</p>
            <nav aria-label="...">
              <ul class="pagination">
                <li class="page-item disabled">
                  <span class="page-link">Previous</span>
                </li>
                <li class="page-item"><a class="page-link" href="#">1</a></li>
                <li class="page-item active">
                  <span class="page-link"> 2 </span>
                </li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item">
                  <a class="page-link" href="#">Next</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>

        <!-- FOOTER -->
        <div class="footer"></div>
      </main>
    </div>
  </div>
</body>

</html>