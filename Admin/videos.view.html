<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>View Video</title>
  <link href="../Cdn/vendor/bootstrap-5.3.3/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="../Cdn/css/admin.global.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

  <script src="../Cdn/vendor/jquery-3.7.1/jquery-3.7.1.min.js"></script>
  <script src="../Cdn/vendor/popper-2.11.8/popper.min.js"> </script>
  <script src="../Cdn/vendor/bootstrap-5.3.3/js/bootstrap.min.js"></script>
  <script src="../Cdn/vendor/validatejs-0.13.1/validate.min.js"></script>
  <script src="../Cdn/js/script.js"></script>

  <script type="text/javascript">

    $(document).ready(function () {
      $(".header").load("header.html");
      $(".sidebar").load("sidebar.html");
      $(".footer").load("footer.html");
    });

    $(document).on("click", ".btn-cancel", function () {
      window.location.href = "videos.list.html";
    });

    $(document).on("click", ".btn-edit", function () {
      var id = $(this).data('id');
      window.location.href = "videos.update.html?id=" + id;
    });

    $(document).ready(function () {
      var urlParams = new URLSearchParams(window.location.search);
      var videoId = urlParams.get('id');

      $.getJSON('../Cdn/js/data/videos.json', function (response) {
        var video = response.data.find(function (item) {
          return item.video_id == videoId;
        });
        if (video) {
          $('#title').val(video.title);
          $('#category').val(video.category);
          $('#description').val(video.description);
          $('#link').val(video.link);
          var editBtn = `<button type="button" data-id='${videoId}' class="btn btn-md btn-success btn-edit btn-outline-success"><span class="text-white">Edit</span></button>`
          $('#edit-btn').html(editBtn)

          var thumbnailImage = "<h6>Uploaded Files</h6><div class='d-flex flex-row justify-content-start align-items-center rounded shadow-sm p-2 bg-white rounded border border-secondary-subtle'><img src='" + video.thumbnail_image + "' class='border border-secondary-subtle p-2 rounded' name='org_logo' style='height: 100px'/><div class='d-flex flex-column'><span class='ms-4 fw-semibold'>" + video.thumbnail_image.split('/').pop() + "</span></div></div>";
          $(".thumbnail_image").html(thumbnailImage);
        } else {
          console.log("Book not found with ID: " + videoId);
        }
      });
    });

    $(document).on("change", "#thumbnail", function (e) {
      var URL = window.URL || window.webkitURL;
      var file = e.target.files[0];

      const imageTag =
        "<h6>Uploaded Files</h6><div class='d-flex flex-row justify-content-start align-items-center rounded shadow-sm p-2 bg-white rounded border border-secondary-subtle'><img src='" +
        URL.createObjectURL(file) +
        "'class='border border-secondary-subtle p-2 rounded' name='org_logo' style='height: 100px'/><div class='d-flex flex-column'><span class='ms-4 fw-semibold'>" +
        e.target.files[0].name +
        "</span> <span class='ms-4 fw-normal'>" +
        formatFileSize(e.target.files[0].size) +
        "</span><div></div>";

      if (file) {
        $(".thumbnail_image").html(imageTag);
      }
    });

    $(window).on('resize', function () {
      if ($(window).width() >= 768)
        $('.sidebar').removeClass('offcanvas offcanvas-start');
      else
        $('.sidebar').addClass('offcanvas offcanvas-start');
    });

    function validateInput(input) {

      let message = [];

      const data = input.reduce(function (obj, item) {
        obj[item.name] = item.value;
        return obj;
      }, {});

      const validator = validate({
        thumbnail: data.thumbnail,
        title: data.title,
        category: data.category,
        description: data.description,
        link: data.link,
      }, {
        logo: {
          type: "image/png,image/jpeg",
        },
        title: {
          presence: { allowEmpty: false },
          type: "string",
          length: { maximum: 100 }
        },
        category: {
          presence: { allowEmpty: false },
        },
        description: {
          presence: { allowEmpty: false },
          type: "string",
          length: { maximum: 350 }
        },
        link: {
          presence: { allowEmpty: false },
          type: "string",
          length: { maximum: 100 }
        },
      });

      if (validator !== undefined) {
        for (key in validator) {
          message.push(validator[key]);
        }
        return message.join(", ");
      }

      return false;

    }
  </script>
</head>

<body>
  <div class="container-fluid p-0 overflow-hidden">
    <div class="row">
      <!-- SIDEBAR -->
      <div class="col-md-3 col-lg-2">
        <div class="col-md-3 col-lg-2 col-lg-2 sidebar position-fixed h-100"
          style="background-color: #1c1c39 !important;" data-bs-backdrop="static" tabindex="-1" id="sidebar">
        </div>
      </div>
      <main class="col py-3">
        <!-- HEADER -->
        <div class="header"></div>
        <form class="p-4" id="form" method="post" action="">
          <input type="hidden" name="csrf_token" id="csrf_token" value="" />
          <div class="d-flex align-items-center">
            <div class="d-flex flex-row justify-content-center align-items-center">
              <i class="bi bi-pencil-square fs-2"></i>
              <h5 class="ms-2 fw-bold">
                Update Video
              </h5>
            </div>
          </div>
          <hr class="m-0">
          <div class="response"></div>
          <div class="mb-3">
            <label for="thumbnail" class="form-label fw-semibold mt-3">Thumbnail Image</label>
            <fieldset class="upload_dropzone text-center p-4">
              <legend class="visually-hidden">Image uploader</legend>
              <i class="bi bi-cloud-arrow-up-fill h1" style="font-size: 5vw;"></i>
              <p class="small my-1">
                Drag &amp; Drop background image(s) inside dashed region<br /><i>or</i>
              </p>
              <input id="thumbnail" name="thumbnail" class="position-absolute invisible" type="file"
                accept="image/jpeg, image/png, image/svg+xml" />
              <label class="btn btn-upload mb-3 bg-primary text-white" for="thumbnail">Choose
                file(s)</label>
              <div class="upload_gallery d-flex flex-wrap justify-content-center gap-3 mb-0"></div>
            </fieldset>
            <div class="mt-3 thumbnail_image"></div>
          </div>
          <input type="file" id="fileInput" style="display: none;">
          <div class="d-flex flex-column form-group">
            <div class="row align-items-end">
              <div class="col-6">
                <label for="title" class="form-label fw-semibold">Title</label>
                <input type="text" name="title" id="title" class="form-control" value="" autocomplete="off">
              </div>
              <div class="col-6">
                <label for="category" class="form-label fw-semibold">Category</label>
                <select id="category" class="form-select" name="category">
                  <option value="" selected disabled>Select category</option>
                  <option value="selling">Selling</option>
                  <option value="real-estate">Real-Estate</option>
                  <option value="properties">Properties</option>
                  <option value="necessities">Necessities</option>
                </select>
              </div>
            </div>
          </div>
          <div class="d-flex flex-column form-group mt-4">
            <label for="description" class="form-label fw-semibold">Description</label>
            <textarea name="description" id="description" class="form-control" value="" autocomplete="off" wrap=physical
              rows="5"></textarea>
          </div>
          <div class="d-flex flex-column form-group">
            <label for="link" class="form-label fw-semibold">Link</label>
            <input type="text" name="link" id="link" class="form-control" value="" autocomplete="off">
          </div>
          <div class="d-flex gap-2 justify-content-end mt-3">
            <button class="btn btn-light btn-cancel border border-secondary" type="button">
              Back
            </button>
            <div id="edit-btn"></div>
          </div>
        </form>
        <!-- FOOTER -->
        <div class="footer"></div>
      </main>
    </div>
  </div>
</body>


</html>