<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update E-Book</title>
    <link href="../Cdn/vendor/bootstrap-5.3.3/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="../Cdn/css/admin.global.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">

    <script src="../Cdn/vendor/jquery-3.7.1/jquery-3.7.1.min.js"></script>
    <script src="../Cdn/vendor/popper-2.11.8/popper.min.js"> </script>
    <script src="../Cdn/vendor/bootstrap-5.3.3/js/bootstrap.min.js"></script>
    <script src="../Cdn/vendor/validatejs-0.13.1/validate.min.js"></script>
    <script src="../Cdn/js/script.js"></script>

    <script type="text/javascript">

        $(window).on('resize', function () {
            if ($(window).width() >= 768)
                $('.sidebar').removeClass('offcanvas offcanvas-start');
            else
                $('.sidebar').addClass('offcanvas offcanvas-start');
        });

        $(document).ready(function () {
            $(".header").load("header.html");
            $(".sidebar").load("sidebar.html");
            $(".footer").load("footer.html");
        });

        $(document).on("click", ".btn-cancel", function () {
            const ebook_id = getParams('ebook_id')
            const title = getParams('title')
            window.location.href = "ebook.chapters.list.html?id=" + ebook_id + "&title=" + title;
        });

        $(document).ready(function () {
            let urlParams = new URLSearchParams(window.location.search);
            let chapterId = urlParams.get('ebook_chapter_id');

            $.getJSON('../Cdn/js/data/ebooks.chapters.json', function (response) {
                var book = response.data.find(function (item) {
                    return item.ebook_chapter_id == chapterId;
                });
                if (book) {
                    $('#chapter').val(book.chapter);
                    $('#content').val(book.content);
                } else {
                    console.log("Book not found with ID: " + chapterId);
                }
            });
        });


        function validateInput(input) {

            let message = [];

            let data = input.reduce(function (obj, item) {
                obj[item.name] = item.value;
                return obj;
            }, {});

            let validator = validate({
                chapter: data.chapter,
                content: data.chapter,
            }, {
                chapter: {
                    presence: { allowEmpty: false },
                    type: "string",
                    length: { maximum: 20 }
                },
                content: {
                    presence: { allowEmpty: false },
                    type: "string",
                    length: { maximum: 400 }
                },
            });

            if (validator !== undefined) {
                for (key in validator) {
                    message.push(validator[key]);
                }
                return message.join(", ");
            }

            return false;

        }
    </script>
</head>

<body>
    <div class="container-fluid p-0 overflow-hidden">
        <div class="row">
            <!-- SIDEBAR -->
            <div class="col-md-3 col-lg-2">
                <div class="col-md-3 col-lg-2 col-lg-2 sidebar position-fixed h-100"
                    style="background-color: #1c1c39 !important;" data-bs-backdrop="static" tabindex="-1" id="sidebar">
                </div>
            </div>
            <main class="col py-3 md-9">
                <!-- HEADER -->
                <div class="header"></div>
                <form class="p-4" id="form" method="post" action="">
                    <input type="hidden" name="csrf_token" id="csrf_token" value="" />
                    <div class="d-flex align-items-center">
                        <div class="d-flex flex-row justify-content-center align-items-center">
                            <i class="bi bi-pencil-square fs-2"></i>
                            <h5 class="ms-2 fw-bold my-auto">
                                Update E-book Chapter
                            </h5>
                        </div>
                    </div>
                    <hr class="m-0">
                    <div class="response"></div>
                    <div class="mt-4">
                        <label for="chapter" class="form-label fw-semibold">Chapter</label>
                        <input type="text" name="chapter" id="chapter" class="form-control" value="" autocomplete="off">
                    </div>
                    <div class="d-flex flex-column form-group mt-4">
                        <label for="content" class="form-label fw-semibold">Content</label>
                        <textarea name="content" id="content" class="form-control" value="" autocomplete="off"
                            wrap=physical rows="5"></textarea>
                    </div>
                    <div class="d-flex gap-2 justify-content-end mt-3">
                        <button class="btn btn-light btn-cancel border border-secondary" type="button">
                            Back
                        </button>
                        <button class="btn-save btn btn-success btn-md">
                            Submit
                        </button>
                    </div>
                </form>
                <!-- FOOTER -->
                <div class="footer"></div>
            </main>
        </div>
    </div>
</body>


</html>